{
  "project": "User Profile Page with Avatar Upload and Settings",
  "created": "2026-01-19T12:00:00Z",
  "projectType": "nuxt",
  "tasks": [
    {
      "name": "extend-user-schema",
      "description": "## Extend User Schema with Profile Fields\n\nAdd profile-related fields to the User model in Prisma schema.\n\n### Implementation\n- Add `avatarUrl` field (optional String) to store the avatar path\n- Add `displayName` field (optional String) for user display name\n- Run `npm run db:generate` and `npm run db:push` to apply changes\n\n### Files to Modify\n- `server/database/schemas/user.prisma`",
      "category": "data",
      "steps": [
        "Open server/database/schemas/user.prisma",
        "Verify avatarUrl field is added as optional String",
        "Verify displayName field is added as optional String",
        "Run npm run db:generate in terminal",
        "Verify Prisma client generates without errors",
        "Run npm run db:push in terminal",
        "Verify database schema updates without errors"
      ],
      "passes": false
    },
    {
      "name": "update-user-types",
      "description": "## Update User Types in Frontend\n\nExtend the User interface in the frontend to include new profile fields.\n\n### Implementation\n- Add `avatarUrl?: string` to User interface\n- Add `displayName?: string` to User interface\n\n### Files to Modify\n- `client/entities/user/model/types.ts`",
      "category": "data",
      "steps": [
        "Open client/entities/user/model/types.ts",
        "Verify User interface includes avatarUrl as optional string",
        "Verify User interface includes displayName as optional string",
        "Run npm run typecheck in terminal",
        "Verify TypeScript compiles without errors"
      ],
      "passes": false
    },
    {
      "name": "user-repository-updates",
      "description": "## Update User Repository\n\nAdd functions to the user repository for profile operations.\n\n### Implementation\n- Add `getUserById(id: number)` function\n- Add `updateUser(id: number, data: { displayName?, avatarUrl? })` function\n- Follow existing repository patterns from `server/database/repositories/users.ts`\n\n### Files to Modify\n- `server/database/repositories/users.ts`",
      "category": "api",
      "steps": [
        "Open server/database/repositories/users.ts",
        "Verify getUserById function is added and returns user by ID",
        "Verify updateUser function is added and accepts id and data object",
        "Verify updateUser can update displayName and avatarUrl fields",
        "Run npm run typecheck to verify no TypeScript errors"
      ],
      "passes": false
    },
    {
      "name": "create-uploads-directory",
      "description": "## Create Uploads Directory Structure\n\nSet up the directory structure for avatar uploads.\n\n### Implementation\n- Create `public/uploads/avatars/` directory\n- Add `.gitkeep` to preserve directory in git\n- Add `public/uploads/.gitignore` to ignore uploaded files but keep structure\n\n### Directory Structure\n```\npublic/\n  uploads/\n    .gitignore\n    avatars/\n      .gitkeep\n```",
      "category": "config",
      "steps": [
        "Navigate to public/ directory",
        "Verify uploads/ directory exists",
        "Verify uploads/avatars/ directory exists",
        "Verify uploads/avatars/.gitkeep file exists",
        "Verify uploads/.gitignore exists with rules to ignore uploaded files",
        "Run git status and verify .gitkeep is trackable"
      ],
      "passes": false
    },
    {
      "name": "update-me-endpoint",
      "description": "## Update /api/auth/me Endpoint\n\nExtend the existing me endpoint to return full profile data including avatar and display name.\n\n### Implementation\n- Update `server/api/auth/me.get.ts`\n- Fetch full user data from database using getUserById\n- Include displayName and avatarUrl in response\n\n### Response Format\n```json\n{\n  \"id\": 1,\n  \"email\": \"user@example.com\",\n  \"displayName\": \"John Doe\",\n  \"avatarUrl\": \"/uploads/avatars/user-1.jpg\"\n}\n```",
      "category": "api",
      "steps": [
        "Start the development server with npm run dev",
        "Log in to the application to get an auth token",
        "Send GET request to /api/auth/me with Authorization header",
        "Verify response status is 200",
        "Verify response includes id and email fields",
        "Verify response includes displayName field (can be null)",
        "Verify response includes avatarUrl field (can be null)"
      ],
      "passes": false
    },
    {
      "name": "profile-update-api",
      "description": "## Create PUT Profile API Endpoint\n\nCreate an API endpoint to update the authenticated user's profile.\n\n### Implementation\n- Create `server/api/users/profile.put.ts`\n- Accept `displayName` in request body\n- Update user in database using updateUser repository function\n- Return updated user data\n- Require authentication (check `event.context.user`)\n\n### Request Body\n```json\n{\n  \"displayName\": \"New Name\"\n}\n```",
      "category": "api",
      "steps": [
        "Start the development server with npm run dev",
        "Send PUT request to /api/users/profile without auth header",
        "Verify response is 401 Unauthorized",
        "Log in and get a valid auth token",
        "Send PUT request to /api/users/profile with body {\"displayName\": \"Test Name\"}",
        "Verify response status is 200",
        "Verify response contains updated displayName",
        "Send GET request to /api/auth/me and verify displayName persisted"
      ],
      "passes": false
    },
    {
      "name": "avatar-upload-api",
      "description": "## Create Avatar Upload API Endpoint\n\nCreate an API endpoint to handle avatar file uploads.\n\n### Implementation\n- Create `server/api/users/avatar.post.ts`\n- Accept multipart form data with image file\n- Validate file type (jpeg, png, gif, webp)\n- Validate file size (max 5MB)\n- Save file to `public/uploads/avatars/` directory with unique filename\n- Update user's avatarUrl in database\n- Return the new avatar URL\n\n### Response Format\n```json\n{\n  \"avatarUrl\": \"/uploads/avatars/user-1-1705xxx.jpg\"\n}\n```",
      "category": "api",
      "steps": [
        "Start the development server with npm run dev",
        "Send POST request to /api/users/avatar without auth header",
        "Verify response is 401 Unauthorized",
        "Log in and get a valid auth token",
        "Create a test image file (valid jpeg/png under 5MB)",
        "Send POST request with multipart form data containing the image",
        "Verify response status is 200",
        "Verify response contains avatarUrl field",
        "Navigate to the returned avatarUrl path and verify image loads",
        "Send POST request with a .txt file",
        "Verify response rejects non-image file types",
        "Send POST request with an image over 5MB",
        "Verify response rejects oversized files"
      ],
      "passes": false
    },
    {
      "name": "avatar-delete-api",
      "description": "## Create Avatar Delete API Endpoint\n\nCreate an API endpoint to delete the user's avatar.\n\n### Implementation\n- Create `server/api/users/avatar.delete.ts`\n- Delete the avatar file from disk if it exists\n- Set user's avatarUrl to null in database\n- Require authentication\n\n### Response\n```json\n{\n  \"success\": true\n}\n```",
      "category": "api",
      "steps": [
        "Start the development server with npm run dev",
        "Ensure user has an avatar uploaded from previous task",
        "Send DELETE request to /api/users/avatar without auth header",
        "Verify response is 401 Unauthorized",
        "Log in and get a valid auth token",
        "Send DELETE request to /api/users/avatar with auth header",
        "Verify response status is 200 with success: true",
        "Send GET request to /api/auth/me",
        "Verify avatarUrl is now null",
        "Check public/uploads/avatars/ directory",
        "Verify the avatar file was deleted from disk"
      ],
      "passes": false
    },
    {
      "name": "profile-api-client",
      "description": "## Create Profile API Client Methods\n\nAdd profile API methods to the frontend user API.\n\n### Implementation\n- Add `updateProfile(data: { displayName?: string })` method to userApi\n- Add `uploadAvatar(file: File)` method to userApi (using FormData)\n- Add `deleteAvatar()` method to userApi\n- Use existing apiClient patterns from `shared/api`\n\n### Files to Modify\n- `client/entities/user/api/userApi.ts`",
      "category": "integration",
      "steps": [
        "Open client/entities/user/api/userApi.ts",
        "Verify updateProfile method exists and calls PUT /api/users/profile",
        "Verify uploadAvatar method exists and handles FormData upload",
        "Verify deleteAvatar method exists and calls DELETE /api/users/avatar",
        "Run npm run typecheck",
        "Verify TypeScript compiles without errors"
      ],
      "passes": false
    },
    {
      "name": "profile-feature-composable",
      "description": "## Create Profile Feature Composable\n\nCreate a composable for managing user profile state and operations in the profile feature.\n\n### Implementation\n- Create `client/features/profile/model/useProfile.ts`\n- Expose `loading` and `error` reactive states\n- Expose `updateProfile(displayName)` method\n- Expose `uploadAvatar(file)` method\n- Expose `deleteAvatar()` method\n- Integrate with useUser composable to refresh user data after updates\n\n### Files to Create\n- `client/features/profile/model/useProfile.ts`",
      "category": "integration",
      "steps": [
        "Open client/features/profile/model/useProfile.ts",
        "Verify useProfile function is exported",
        "Verify loading ref is exposed",
        "Verify error ref is exposed",
        "Verify updateProfile method is implemented",
        "Verify uploadAvatar method is implemented",
        "Verify deleteAvatar method is implemented",
        "Run npm run typecheck",
        "Verify no TypeScript errors"
      ],
      "passes": false
    },
    {
      "name": "avatar-upload-component",
      "description": "## Create Avatar Upload Component\n\nCreate a reusable avatar upload component with preview and interaction.\n\n### Implementation\n- Create `client/features/profile/ui/AvatarUpload.vue`\n- Show current avatar image or default placeholder icon\n- Click to trigger hidden file input for selection\n- Show loading spinner during upload\n- Include delete button when avatar exists\n- Emit `upload` event with File when file selected\n- Emit `delete` event when delete clicked\n\n### Props\n- `avatarUrl?: string` - Current avatar URL\n- `loading?: boolean` - Upload in progress\n\n### Events\n- `@upload(file: File)` - File selected for upload\n- `@delete` - Delete current avatar",
      "category": "ui",
      "steps": [
        "Start the development server with npm run dev",
        "Navigate to a page using the AvatarUpload component",
        "Verify component renders without errors",
        "Verify placeholder icon shows when no avatarUrl provided",
        "Verify avatar image shows when avatarUrl is provided",
        "Click on the avatar area",
        "Verify file picker dialog opens",
        "Select an image file",
        "Verify upload event is emitted (check Vue DevTools or console)",
        "Set loading prop to true",
        "Verify loading spinner is displayed",
        "Verify delete button appears when avatar exists",
        "Click delete button",
        "Verify delete event is emitted"
      ],
      "passes": false
    },
    {
      "name": "profile-form-component",
      "description": "## Create Profile Form Component\n\nCreate a form component for editing user profile settings.\n\n### Implementation\n- Create `client/features/profile/ui/ProfileForm.vue`\n- Include AvatarUpload component at top\n- Display name input field with v-model\n- Email display (read-only, styled differently)\n- Save button with loading state\n- Form validation (displayName max 50 chars)\n\n### Props\n- `user: User` - Current user data\n- `loading?: boolean` - Save in progress\n\n### Events\n- `@save(data: { displayName: string })` - Form submitted\n- `@upload-avatar(file: File)` - Avatar upload requested\n- `@delete-avatar` - Avatar delete requested",
      "category": "ui",
      "steps": [
        "Start the development server with npm run dev",
        "Navigate to a page using the ProfileForm component",
        "Verify AvatarUpload component renders at top",
        "Verify display name input field is present and editable",
        "Verify email field is displayed but read-only/disabled",
        "Type a new display name in the input",
        "Click the Save button",
        "Verify save event is emitted with displayName data",
        "Enter a display name longer than 50 characters",
        "Verify validation error is shown or input is limited",
        "Set loading prop to true",
        "Verify Save button shows loading state"
      ],
      "passes": false
    },
    {
      "name": "profile-feature-exports",
      "description": "## Export Profile Feature Public API\n\nSet up the public API exports for the profile feature following FSD patterns.\n\n### Implementation\n- Create `client/features/profile/index.ts`\n- Export useProfile composable\n- Export ProfileForm component\n- Export AvatarUpload component\n\n### FSD Pattern\nAll exports should be from the feature's public API only",
      "category": "config",
      "steps": [
        "Open client/features/profile/index.ts",
        "Verify useProfile is exported",
        "Verify ProfileForm is exported",
        "Verify AvatarUpload is exported",
        "Run npm run typecheck",
        "Verify imports work from '~/features/profile'"
      ],
      "passes": false
    },
    {
      "name": "profile-page",
      "description": "## Create Profile Page\n\nCreate the main profile page at `/profile` route.\n\n### Implementation\n- Create `client/pages/profile.vue`\n- Use useAuth for authentication check and user data\n- Use useProfile for profile operations\n- Include ProfileForm component\n- Handle avatar upload/delete through useProfile\n- Handle profile save through useProfile\n- Show success/error feedback (toast or inline messages)\n- Redirect to login if not authenticated\n- Page layout consistent with existing pages (files.vue)\n\n### Features\n- Auth check on mount (redirect if not authenticated)\n- Display ProfileForm with current user data\n- Save profile changes\n- Upload new avatar\n- Delete avatar\n- Success/error feedback",
      "category": "ui",
      "steps": [
        "Start the development server with npm run dev",
        "Navigate to /profile without being logged in",
        "Verify redirect to /login page",
        "Log in to the application",
        "Navigate to /profile",
        "Verify profile page loads without errors",
        "Verify ProfileForm displays current user data",
        "Change the display name and click Save",
        "Verify success feedback is shown",
        "Refresh the page",
        "Verify display name change persisted",
        "Click on avatar to upload a new image",
        "Select a valid image file",
        "Verify avatar updates and success feedback shown",
        "Click delete avatar button",
        "Verify avatar is removed and success feedback shown"
      ],
      "passes": false
    },
    {
      "name": "header-profile-link",
      "description": "## Add Profile Link to Header\n\nUpdate the app header to include a link to the profile page with avatar thumbnail.\n\n### Implementation\n- Modify `client/widgets/app-header/ui/AppHeader.vue`\n- Add clickable profile area next to logout button\n- Show user avatar thumbnail if available (small circular image)\n- Show user icon placeholder if no avatar\n- Link/navigate to /profile on click\n- Maintain existing header layout and styling\n\n### Files to Modify\n- `client/widgets/app-header/ui/AppHeader.vue`",
      "category": "ui",
      "steps": [
        "Start the development server with npm run dev",
        "Log in to the application",
        "Look at the header area",
        "Verify profile link/button is visible",
        "If user has no avatar, verify placeholder icon is shown",
        "Upload an avatar via profile page",
        "Return to files page and check header",
        "Verify avatar thumbnail now shows in header",
        "Click the profile area in header",
        "Verify navigation to /profile page occurs"
      ],
      "passes": false
    }
  ]
}
